<mat-card class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
  <mat-card-header>
    <div mat-card-avatar class="header-image"></div>
    <mat-card-title i18n>{{ quizData?.milestone }} Quiz</mat-card-title>
    <mat-card-subtitle i18n>Results</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <section class="results">
      <h3 i18n>Congratulations! You&apos;ve completed the quiz!</h3>
      <section class="statistics">
        <ng-template
          let-percentage
          [ngTemplateOutlet]="percentageTemplate" #percentageTemplate
          [ngTemplateOutletContext]="{ $implicit: (((correctAnswersCount$ | async) / totalQuestions) * 100) }">
          <span class="your-score" i18n>
            You scored {{ correctAnswersCount$ | async }} out of {{ totalQuestions }}
            ({{ percentage }}%) questions correctly.</span>

          <div class="quiz-feedback">
            <div *ngIf="percentage >= 80">
              <img mat-card-image src="../../assets/images/congratulations.jpg" alt="Photo of 'Congratulations'">
              <h3 i18n>Great job! </h3>
            </div>
            <div *ngIf="percentage >= 60 && percentage < 80">
              <img mat-card-image src="../../assets/images/notbad.jpg" alt="Photo of 'Not Bad'">
              <h3 i18n>Not bad! </h3>
            </div>
            <div *ngIf="percentage < 60">
              <img mat-card-image src="../../assets/images/tryagain.jpeg" alt="Photo of 'Try Again'">
              <h3 i18n>Try again! </h3>
            </div>

            <ngb-progressbar
              type="success"
              [striped]="true"
              [animated]="true"
              [value]="percentage"
              class="progress-bar bg-success">
              <strong>{{ percentage }}%</strong>
            </ngb-progressbar>
          </div>
        </ng-template>

        <section class="completion-time">
          <span class="elapsed-time" i18n>
            <ng-template
              let-elapsedMinutes
              [ngTemplateOutletContext]="{ $implicit: Math.floor((completionTime$ | async) / 60) }"
              [ngTemplateOutlet]="elapsedMinutesTemplate" #elapsedMinutesTemplate>
              You completed the quiz in {{ elapsedMinutes }} minutes and
            </ng-template>
            <ng-template
              let-elapsedSeconds
              [ngTemplateOutletContext]="{ $implicit: ((completionTime$ | async) % 60) }"
              [ngTemplateOutlet]="elapsedSecondsTemplate" #elapsedSecondsTemplate>
              {{ elapsedSeconds }} seconds.
            </ng-template>
          </span>
        </section>

        <br clear="all" />
      </section>

      <section class="quizSummary">
        <details>
          <summary>Click to view a more detailed summary of your quiz</summary>

          <mat-accordion [multi]="true" #accordion="matAccordion">
            <mat-expansion-panel
              class="quiz-summary-question"
              *ngFor="let question of quizData.questions; index as i"
              (opened)="panelOpenState = true" (closed)="panelOpenState = false" hideToggle="true">

              <mat-expansion-panel-header>
                <mat-panel-description>
                  <mat-icon class="accordion-icon" *ngIf="!panelOpenState">add</mat-icon>
                  <mat-icon class="accordion-icon" *ngIf="panelOpenState">remove</mat-icon>
                </mat-panel-description>

                <mat-panel-title>
                  <span class="question-leader" i18n>Question #{{ i + 1 }}: </span>&nbsp;&nbsp;
                  <span class="question-text" i18n>{{ question?.questionText }}</span>
                </mat-panel-title>

                <ng-template
                  matExpansionPanelContent
                  *ngFor="let userAnswer of userAnswers; let correctAnswer of correctAnswers">
                  <div class="quiz-summary-field">
                    <span i18n>
                      <span class="leader">Your Answer: </span>
                      Option {{ userAnswer }} &mdash; {{ question?.options[userAnswer - 1].text }}
                      <mat-icon class="correct" *ngIf="question?.options[userAnswer].correct === true">done</mat-icon>
                      <mat-icon class="incorrect" *ngIf="question?.options[userAnswer].correct === false">clear</mat-icon>
                      <span *ngIf="!userAnswer"> (no answer provided)</span>
                    </span>
                  </div>
                  <div class="quiz-summary-field">
                    <span i18n>
                      <span class="leader">Correct Answer(s): </span>
                      Option {{ correctAnswer }} &mdash; {{ question?.options[correctAnswer - 1].text }}
                    </span>
                  </div>
                  <div class="quiz-summary-field">
                    <span i18n>
                      <span class="leader">Explanation: </span>
                      Option {{ correctAnswer }} was correct because {{ question?.explanation }}.
                    </span>
                  </div>
                  <!-- <div class="quiz-summary-field">
                    <span i18n>
                      <span class="leader">Elapsed Time: </span> {{ elapsedTimes[i] }} seconds
                    </span>
                  </div> -->
                </ng-template>
              </mat-expansion-panel-header>
            </mat-expansion-panel>
          </mat-accordion>
          <mat-action-row class="mat-accordion-buttons">
            <button mat-raised-button color="primary" (click)="openAllPanels()">
              <strong>Expand All</strong>&nbsp;&nbsp;<mat-icon>unfold_more</mat-icon>
            </button> &nbsp;
            <button mat-raised-button color="primary" (click)="closeAllPanels()">
              <strong>Collapse All</strong>&nbsp;&nbsp;<mat-icon>unfold_less</mat-icon>
            </button>
          </mat-action-row>
        </details>
      </section>
    </section>

    <section class="return">
      <mat-card-actions>
        <a class="btn" (click)="restart()">
          <i class="fas fa-power-off"></i>&nbsp;&nbsp;Restart Quiz
        </a>
        <a class="btn" href={{codelabUrl}}>
          <i class="fas fa-laptop"></i>&nbsp;&nbsp;Back to Codelab
        </a>
      </mat-card-actions>
    </section>

    <hr />

    <section class="challenge-social">
      <h4>Challenge your friends!</h4>
      <div class="social-buttons">
        <a class="btn email"
           href="mailto:?subject=Try to beat my quiz score!&amp;body=I scored {{ percentage }}% on this awesome Angular quiz. Try to beat my score at {{ codelabUrl }}">Email a friend</a>
        <a class="btn twitter" target="_blank"
           href="https://www.twitter.com/share?text=I scored {{ percentage }}% on this awesome Angular quiz. Try to beat my score at &amp;hashtag=quiz&amp;url={{ codelabUrl }}">Tweet your score</a>
      </div>
    </section>
  </mat-card-content>
</mat-card>
