<ng-container *ngIf="renderReady && canDisplayOptions && optionsToDisplay?.length > 0; else noOptions">

<form [formGroup]="form">

  <!-- SINGLE-ANSWER (radio) -->
  <mat-radio-group
    *ngIf="optionBindings[0].type === 'single'"
    formControlName="selectedOptionId"
    (change)="handleRadioGroupChange($event)">

    <ng-container *ngFor="let b of optionBindings; let i = index; trackBy: trackByOptionId">
      <ng-container 
        *ngTemplateOutlet="radioOptionTemplate; context: getOptionContext(b, i)">
      </ng-container>
    </ng-container>
  </mat-radio-group>

  <!-- MULTIPLE-ANSWER (checkbox) -->
  <div *ngIf="optionBindings[0].type === 'multiple'">
    <ng-container *ngFor="let b of optionBindings; let i = index; trackBy: trackByOptionId">
      <ng-container 
        *ngTemplateOutlet="checkboxOptionTemplate; context: getOptionContext(b, i)">
      </ng-container>
    </ng-container>
  </div>

</form>

</ng-container>

<ng-template #radioOptionTemplate let-optionBinding let-index="index">
<mat-radio-button [value]="optionBinding?.option?.optionId" name="selectedOptionId">
  <span class="option-text">
    {{ getOptionDisplayText(optionBinding?.option, index) }}
  </span>
  <mat-icon *ngIf="shouldShowIcon(optionBinding?.option)" class="opt-icon">
    {{ getOptionIcon(optionBinding?.option) }}
  </mat-icon>
</mat-radio-button>
</ng-template>

<ng-template #checkboxOptionTemplate let-optionBinding let-index="index">
<div class="option-row" *ngIf="optionBinding?.option">
  <label class="option-row options"
         appHighlightOption
         [optionBinding]="optionBinding"
         [isCorrect]="optionBinding?.isCorrect">

    <mat-checkbox
      [checked]="optionBinding?.option?.selected"
      (change)="onMatCheckboxChanged(optionBinding, index, $event)">

      <span class="option-text">
        {{ getOptionDisplayText(optionBinding?.option, index) }}
      </span>

      <mat-icon *ngIf="shouldShowIcon(optionBinding?.option)"
                class="opt-icon">
        {{ getOptionIcon(optionBinding?.option) }}
      </mat-icon>
    </mat-checkbox>
  </label>

  <codelab-quiz-feedback
    *ngIf="shouldShowFeedback(index)"
    [feedbackConfig]="feedbackConfigs[index]">
  </codelab-quiz-feedback>
</div>
</ng-template>




<ng-template #noOptions>
<span style="min-height: 1rem;">Loading options...</span>
</ng-template>
