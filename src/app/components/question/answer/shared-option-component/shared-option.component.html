<ng-container *ngIf="canDisplayOptions; else noOptions">
  <form [formGroup]="form">

    <div *ngFor="let optionBinding of optionBindings; let optionIndex = index; trackBy: trackByOption">
      <label class="options">

        <ng-container [ngSwitch]="optionBinding.type">

          <!-- SINGLE‐ANSWER -->
          <mat-radio-button
            *ngSwitchCase="'single'"
            formControlName="selectedOptionId"
            [value]="optionBinding.option.optionId"
            (click)="onRadioClick(optionBinding, optionIndex)"
            appHighlightOption
            [optionBinding]="optionBinding"
          >
            <ng-container
              *ngTemplateOutlet="optionContent; context: getOptionContext(optionBinding, optionIndex)"
            ></ng-container>
          </mat-radio-button>

          <!-- MULTIPLE‐ANSWER -->
          <mat-checkbox
            *ngSwitchCase="'multiple'"
            [checked]="optionBinding.option.selected"
            [value]="optionBinding.option.optionId"
            (change)="onMatCheckboxChanged(optionBinding, optionIndex, $event)"
            appHighlightOption
            [optionBinding]="optionBinding"
          >
            <ng-container
              *ngTemplateOutlet="optionContent; context: getOptionContext(optionBinding, optionIndex)"
            ></ng-container>
          </mat-checkbox>

        </ng-container>

        <!-- Feedback under every option -->
        <codelab-quiz-feedback
          *ngIf="shouldShowFeedback(optionIndex)"
          [feedbackConfig]="feedbackConfigs[optionIndex]"
        ></codelab-quiz-feedback>

      </label>
    </div>

  </form>
</ng-container>

<!-- Option display template -->
<ng-template #optionContent let-option="option" let-optionIndex="idx">
  <div class="option-content">
    <span class="option-text" [ngStyle]="optionTextStyle">
      {{ getOptionDisplayText(option, optionIndex) }}
    </span>
    <mat-icon
      *ngIf="shouldShowIcon(option)"
      [ngClass]="optionIconClass"
    >
      {{ getOptionIcon(option) }}
    </mat-icon>
  </div>
</ng-template>

<!-- Fallback -->
<ng-template #noOptions>
  <p>No options available.</p>
</ng-template>
