<ng-container *ngIf="optionBindings?.length; else noOptions">
  <form [formGroup]="form">

    <!-- SINGLE-ANSWER MODE -->
    <ng-container *ngIf="optionBindings[0].type === 'single'; else multiBlock">
      <!-- ONE radio-group owns the form control -->
      <mat-radio-group
        formControlName="selectedOptionId">

        <!-- one loop for all options -->
        <div *ngFor="let b of optionBindings; let i = index; trackBy: trackByOption"
            class="option-row options">

          <label appHighlightOption [optionBinding]="b" [isCorrect]="b.isCorrect">
            <mat-radio-button 
              [value]="b.option.optionId"
              (click)="onRadioClick(b, i)">
              <span class="opt-text">
                {{ getOptionDisplayText(b.option, i) }}
              </span>

              <mat-icon *ngIf="shouldShowIcon(b.option)"
                        class="opt-icon">
                {{ getOptionIcon(b.option) }}
              </mat-icon>

            </mat-radio-button>
          </label>

          <codelab-quiz-feedback
            *ngIf="shouldShowFeedback(i)"
            [feedbackConfig]="feedbackConfigs[i]">
          </codelab-quiz-feedback>
        </div>

      </mat-radio-group>
    </ng-container>

    <!-- MULTIPLE-ANSWER MODE -->
    <ng-template #multiBlock>
      <div *ngFor="let b of optionBindings; let i = index; trackBy: trackByOption"
          class="option-row options">

        <label appHighlightOption [optionBinding]="b" [isCorrect]="b.isCorrect">
          <mat-checkbox
            [checked]="b.option.selected"
            (change)="onMatCheckboxChanged(b, i, $event)"
            (click)="optionClick$.next({ binding: b, idx: i })">

            <span class="opt-text">
              {{ getOptionDisplayText(b.option, i) }}
            </span>

            <mat-icon *ngIf="shouldShowIcon(b.option)"
                      class="opt-icon">
              {{ getOptionIcon(b.option) }}
            </mat-icon>

          </mat-checkbox>
        </label>

        <codelab-quiz-feedback
          *ngIf="shouldShowFeedback(i)"
          [feedbackConfig]="feedbackConfigs[i]">
        </codelab-quiz-feedback>
      </div>
    </ng-template>

  </form>
</ng-container>

<ng-template #noOptions><p>No options available.</p></ng-template>
