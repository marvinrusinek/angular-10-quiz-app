<ng-container 
  *ngIf="renderReady && canDisplayOptions && optionsToDisplay?.length > 0; else noOptions"
  [style.visibility]="finalRenderReady ? 'visible' : 'hidden'"
  [style.minHeight]="'1rem'">

  <form [formGroup]="form" class="options-form">
  <div class="options-group">
    <ng-container *ngFor="let b of optionBindings; let i = index; trackBy: trackByOptionId">
      <!-- Wrapping container where highlight directive applies -->
      <div
        class="option-row options"
        appHighlightOption
        [option]="b.option"
        [optionBinding]="b"
        [isSelected]="b.isSelected"
        [isCorrect]="b.isCorrect"
        [selectedOptionHistory]="selectedOptionHistory"
        [highlightCorrectAfterIncorrect]="highlightCorrectAfterIncorrect"
        [appHighlightInputType]="type"
        [appHighlightReset]="shouldResetBackground"
      >
        <!-- SINGLE-ANSWER -->
        <mat-radio-button
          *ngIf="type === 'single'"
          class="option-control option"
          [value]="b.option.optionId"
          (click)="handleClick(b, i)"
          (change)="updateOptionAndUI(b, i, $event)"
        >
          <div class="option-wrapper">
            <span class="option-text">{{ getOptionDisplayText(b.option, i) }}</span>
            <mat-icon *ngIf="shouldShowIcon(b.option)" class="opt-icon">
              {{ getOptionIcon(b.option) }}
            </mat-icon>
          </div>
        </mat-radio-button>

        <!-- MULTIPLE-ANSWER -->
        <mat-checkbox
          *ngIf="type === 'multiple'"
          class="option-control option"
          [checked]="b.option.selected"
          [value]="b.option.optionId"
          (click)="handleClick(b, i)"
          (change)="updateOptionAndUI(b, i, $event)"
        >
          <div class="option-wrapper">
            <span class="option-text">{{ getOptionDisplayText(b.option, i) }}</span>
            <mat-icon *ngIf="shouldShowIcon(b.option)" class="opt-icon">
              {{ getOptionIcon(b.option) }}
            </mat-icon>
          </div>
        </mat-checkbox>

        <!-- Feedback below both -->
        <div *ngIf="showFeedbackForOption[b.option.optionId]" class="feedback-wrapper">
          <codelab-quiz-feedback
            *ngIf="b.option.optionId === lastFeedbackOptionId"
            [feedbackConfig]="feedbackConfigs[b.option.optionId]"
          ></codelab-quiz-feedback>
        </div>
      </div>
    </ng-container>
  </div>
</form>

</ng-container>

<ng-template #noOptions>
  <span style="min-height: 1rem;">Options not ready...</span>
</ng-template>
